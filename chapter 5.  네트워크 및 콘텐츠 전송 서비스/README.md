# 네트워크 및 콘텐츠 전송 서비스


## IP 주소
- 웹서버는 데이터 센터나 클라우드 서비스에 있을 수 있는데 <mark style="background: #DCFF8C;">웹 서버가 그곳에 있다는 특정 정보</mark>
- 퍼블릭 IP 주소 - 전 세계에서 이 주소는 인터넷에서 '이곳' 이라고 특정할 수 있는 주소, 어디서든 접근 가능
- 프라이빗 IP 주소 - 근거리 통신(LAN) 내에서만 식별할 수 있는 주소
	- (<mark style="background: #DCFF8C;">**클래스 A**</mark> 범위) 10.0.0.0~10.255.255.255 
		- 네트워크 개수가 적다. -> '같은 서브넷 마스크 사용시 나눌 수 있는 개별 네트워크의 수가 적다' 는 말(IP 대역을 작을 단위로 쪼개기 어렵다)
		- 클래스 A 는 대규모 네트워크에 적합
		- 네트워크당 호스트 수가 많음
	- (<mark style="background: #DCFF8C;">**클래스 B**</mark> 범위) 172.16.0.0 ~ 172.31.255.255 
		- 네트워크 개수 중간
		- 중간 규모 네트워크에 적합 (기업, 기관)
		- 네트워크당 호스트 수가 중간
	- (**<mark style="background: #DCFF8C;">클래스 C</mark>** 범위) 192.168.0.0 ~ 192.168.255.255
		- 네트워크 개수 많음
		- 소규모 네트워크에 적합
		- 호스투 수가 적음
- 서브넷 마스크란?
	- IP 주소에서 네트워크 부분과 Host 부분을 구분하는 역할을 하는 값, 네트워크 범위를 정의하고 IP 주소를 그룹으로 나누는데 사용
	- IP 를 2진수로 표기할때를 기준으로 x.x.x.x/16 의 경우 왼쪽에서 16번째 까지 네트워크 부분이라는 말
	- IP 를 2진수로 표기할때를 기준으로 x.x.x.x/28 의 경우 왼쪽에서 28번째 까지 이외의 하위 비트가 호스트에 해당한다.
		-> 이런식으로 network-host 구분을 해준다.

## 로드밸런서
- 부하를 분산하기 위해 서버를 여러 대 구성해 각 서버가 처리를 나눠서 할 수 있게 구축할 수 있도록 하는 장치
- 요청이 웹 서버에 도달하기 전에 받아 부하가 낮은 서버로 전달
	![[Excalidraw/Drawing 2025-02-09 20.36.00.excalidraw.md]]
- 서버 하나가 정지 되어도 다른 서버가 계속 실행되므로 시스템 전체적으로는 문제 없이 서비스 제공 가능


## 라우팅 및 라우팅 테이블
- 어떤 IP 주소를 찾아가기 위해서는 해당 주소까지의 경로를 알아야 한다, 하지만 사용자는 이런 경로를 알 필요가 없다. <mark style="background: #DCFF8C;">라우터</mark>가 최적의 경로를 찾아서 경로를 결정하고 연결한다. -> 라우터가 IP 주소까지의 경로를 결정하는 것을 <mark style="background: #DCFF8C;">라우팅</mark>이라 한다.
- 각 라우터는 소유한 경로 정보를 기반으로 목적지 IP 주소를 향해 이동해야 하는 네트워크를 결정하는데 이 경로 정보를 <mark style="background: #DCFF8C;">라우팅 테이블</mark>이라 한다. -> 라우터가 소유한 네트워크의 지도 같은 것


## DNS
- 도메인 이름에는 IP 주소가 연결되어있어 사용자는 도메인 이름으로만 사이트에 접속이 가능하다.
- DNS 가 우리 대신 도메인 이름에 연결된 IP 주소를 찾아주기 떄문이다.


## 가상 네트워크 Amazon <mark style="background: #DCFF8C;">VPC</mark>
- **VPC 란?**
	- **AWS 에서 생성할 수 있는 프라이빗 가상 네트워크 공간**
- VPC 만으로는 EC2와 같은 자원을 네트워크에 만들 수 없다.
	- <mark style="background: #DCFF8C;">VPC 안에 더 작은 네트워크 단위인 서브넷</mark>을 만들어야 한다. -> 하나의 서브넷은 하나의 AZ 에 속하며 여러 AZ에 속할 수 없다.
	- **VPC 내부에 퍼블릭 서브넷, 프라이빗 버스넷, DB 서브넷을 생성해 AWS 리소스를 배치**한다.
	![[Excalidraw/Drawing 2025-02-09 20.36.00.excalidraw.md]]
- 하나의 VPC를 논리적으로 나눠 분리가능, 여러 VPC 연결 가능
- 호스트 주소는 여유를 갖도록 가능한 한 많이 확보해 두는 것이 좋다
- VPC를 생성하고 해당 가상 네트워크 공간에 EC2, RDS, Gateway, 컨테이너 등을 배치해 운영할 수 있다.
- 일반적으로 프라이빗 IP 주소를 사용 (AWS 권고사항)
- CIDR (IP 주소 범위)
	- VPC를 만들때 CIDR 블록을 지정하고 지정한 CIDR 블록 네트워크를 확보한다. (일반적으로 총 IP 주소 수를 파악하는 것은 어렵다)
- VPC peering (VPC 간 연결) 시 같은 주소 대역이 여러 네트워크에 존재하지 못하도록 하고있다.
- EC2 와 같은 VPC의 자원은 IP 주소마다 네트워크 인터페이스(ENI)를 가진다
### 네트워크 접근 제어목록 (<mark style="background: #DCFF8C;">ACL</mark>)
-<mark style="background: #DCFF8C;"> 서브넷 단위로 접근 제어</mark>를 설정할 수 있도록 한다.
- 보안 그룹과 조합해 접근제어 설정 가능
- 네트워크 ACL이나 보안 그룹에서 허용되거나 거부된 통신 상황은 VPC 흐름 로그라고 하는 VPC 내의 IP 트래픽 상황을 로그로 저장할 수 있는 기능을 사용해 확인 가능
	- CloudWatch(로그 모니터링 서비스) 나 S3 에 저장도 가능 (요금은 S3가 저렴)
	- CloudWatch의 경우 로그 내용에 따라 알림을 보낼 수 있게 구성해 감시가 가능하다.

- 보안그룹 - 네트워크 ACL 비교표

|          | 네트워크 ACL             | 보안그룹                               |
| :------- | :------------------- | :--------------------------------- |
| 설정 단위    | 서브넷 단위               | 인스턴스(자원) 단위                        |
| 허용/거부 설정 | 허용 및 서부 설정 가능        | 허용만 가능 (허용하지 않는 모든 것은 거부)          |
| 상태 저장 여부 | 상태 비저장, 단일 패킷만 확인하므로 | 상태 저장<br>패킷과 관련된 세션까지 확인하므로 정보를 저장 |
![[Excalidraw/Drawing 2025-02-09 20.36.00.excalidraw.md]]
위 이미지 처럼 두 가지 접근 제어 기능으로 보안 네트워크 구축

## VPC의 주요 기능 사용법
### 라우팅 테이블
- AWS 는 VPC에 라우팅 테이블을 생성하고 각 서브넷에 사용할 라우팅 테이블을 지정한다.
	- 해당 라우팅 테이블의 정보를 기반으로 VPC를 통해 흐르는 패킷이 어디로 통신할지 결정한다.
- 기본 상태에서는 VPC 내의 라우팅 정보만 있으므로 VPC 외부로는 통신 불가
	- 외부와 통신하려면 외부 라우팅 정보 추가가 필요하다
	- ex) 0.0.0.0/0 (모든 네트워크) 에 대해 인터넷 게이트웨이로 라우팅 테이블에 등록하면 인터 통신이 가능
	  
### 인터넷 게이트웨이
- 서브넷 안에 있는 EC2 와 같은 자원이 인터넷과 통신할 수 있게 하기 위한 기능
- 퍼블릭 서브넷 - 인터넷 게이트웨이로 가능 경로가 설정된 서브넷
- 프라이빗 서브넷 - 인터넷 게이트웨이를 통해 인터넷과 통신할 수 없는 서브넷
- EC2의 경우 퍼블릭 IP 혹은 Ekastic IP 를 부여해 인터넷과 EC2가 통신할 수 있다.
	- 퍼블릭 IP
		- 자동으로 부여되는 IP 주소, 재부팅시마다 변경
		- 무료
	- Elastic IP
		- 정적 IP, 영구적 사용 가능하며 방화벽 등에서 IP 주소를 고정해 통신을 허가해야 하는 경우 사용
		- 사용하지 않는 경우 요금 부과, 가동중인 EC2 등에서 사용하는 경우 무료


## NAT 게이트웨이
- 프라이빗 IP 주소를 퍼블릭 IP 주소로 변환하는 것을 의미
- 프라이빗 서브넷에 있는 EC2와 같은 자원은 일반적으로 인터넷과 통신 불가, 인터넷에서 다운로드 해야하는 경우가 있는데 이럴때 사용한다.
- 외부 통신을 수행하는 서브넷의 라우팅 테이블에 라우팅 정보를 등록해야 한다.


## VPC - VPC, 외부서비스, 온프레미스와의 연결
### 1. VPC 피어링
- 서로 다른 두 개의 VPC를 연결해 통신 (연결하는 경우 CIDR 블록은 겹치면 안됨)
- 세 개의 VPC 가 서로 통신하는 경우 각 VPC 끼리 따로 피어링을 구성해야한다.

### 2. AWS Transit Gateway
- VPC 연결을 하나의 중앙 허브에서 관리
- 요금이 피어리보다 높지만 많은 VPC 사용시 중앙 관리가 편하다.

### 3. VPC 엔드포인트
- 프라이빗 네트워크로 통신한다.
- VPC 엔트포인트를 설정한 VPC는 VPC 엔드포인트를 통해 S3 와 같은 다른 AWS 서비스에 직접 접근이 가능하다.
- 게이트웨이 엔드포인트 - S3, DynamoDB 에서 사용하는 VPC 엔드포인트
- 인터페이스 엔드포인트 - AWS PrivateLink 라는 기능을 사용해 서브넷에 서비스 접속용 네트워크 인터페이스를 생성해 프라이빗 IP로 통신한다. (S3, DynamoDB 이외의 많은 AWS 서비스를 지원)

### 4. Site-to-Site VPN
- 온플레미스 환경의 네트워크와 VPC를 VPN으로 연결하는 기능
- 프라이빗 네트워크라고 하지만 인터넷을 통해 통신이 이루어진다.
- IPsec 기술을 사용해 인터넷에 가상으로 전용 네트워크를 만드는 형태
- 온프레미스 환경의 클라이언트 단말과 VPN을 연결하는 AWS Client VPN 이라는 기능도 있다
	- 온프레미스 환경 전체가 아닌 특정 단말과 비공개로 연결하고 싶은 경우 이 서비스 추천
- VPN 이란?
	- Virtual Private network 의 약자
	- 프라이빗 네트워크를 구성해 통신하는 기술
	- VPN에 접속하면 외부 네트워크와 프라이빗 IP 주소로 통신할 수 있다.
- IPsec 란?
	- 네트워크 통신에서 data를 암호화하고 보호하는 보안 프로토콜



## <mark style="background: #DCFF8C;">ELB</mark> (Elastic Load Balancing)
- AWS 에서 제공하는 로드 밸런서 서비스 (주요기능 - 트래픽을 로드 밸런싱, 인스턴스가 멈추지 않고 실행중인지 정기적으로 확인해 가용성 확인)
- ELB 기본 기능
	- 부하 분산 - 접속을 여러 서버에 자동 분산
	- 대상 모니터링 - 트래픽 도착지에 대한 연결과 상태를 감시하고 확인
	- 보안 - 보안 그룹을 비롯한 AWS의 기본적인 보안 서비스 적용가능, SSL/TLS 서버 인증서를 설정해 암호화 통신 수행 가능
- ALB, NLB 가 대표적
	- ALB (어플리케이션 로드 밸런서)
		- HTTP 트래픽과 HTTPS 트래픽의 부하 분산이 가능
		- 레이어 7로 동작, 마이크로서비스나 컨테이너들 다양한 프로그램에도 대응 가능
	- NLB (네트워크 로드 밸런서)
		- 레이어 4에서 동작하므로 HTTP/HTTPS 외에 TCP, UDP, TLS 트래픽의 부하 분산도 다능
		- 수백만건 이상 요청이 발생하는 대규모 트래픽에서도 속도가 빠름


## <mark style="background: #DCFF8C;">Route 53</mark>
- AWS 가 제공하는 DNS 서비스
- 등록한 도메인데 대해 호스팅 영역이 만들어지고 다양한 설정이 관리된다
- 도메인 구매후 AWS 에서 Route 53 DNS 서버를 사용하면 비용이 든다, 만약 외부 DNS를 사용하면 무료로 사용가능 할수도
- 주요 특징
	- 높은 가용성 - 품질보즌 100%로 정의(다른 서비스에 비해 높은 가용성 제공), 전 세계에 걸쳐 이중화 되어있기 때문
	- 높은 비용 성능 - 처음 25 개의 호스팅 영역 1개당 0.5USD/월 정도로 이용 가능
- 기능
	- 도메인 등록
	- 도메인 트래픽 라우팅
	- 자원에 대한 상태 확인 - eotkddl wjdtkdwjrdmfh tlfgodwnddlswl ghkrdls
- 라우팅 정책
	- 단순 라우팅 - 하나의 도메인에 대해 하나의 IP 주소 연결
	- 가중치 기반 라우팅 - 라우팅 대상을 여러개등록, 가중치를 할당해 가중치가 높은 IP 가 트래픽을 많이 받도록
	- 지리적 위치 라우팅
		- 조회한 곳의 위치 정보에 따하 어떤 IP 주소를 반환할지 결정
		- 글로벌 서비스에 필요할듯
	- 지연 시간 라우팅
		- 항상 레이턴시(데이터 처리 지연시간)가 최소인 자원의 IP 주소를 우선적으로 반환
	- 장애 조치 라우팅
		- 프라이머리에 장애 발생시 보조로 라우팅 (프라이머리가 메인, 보조가 따로있음)
	- 다중값 응답 라우팅
		- 여러 IP 주소를 무작위로 반환
		- ELB의 역할을 해주니 ELB를 사용하는것과 비교해서 사용하면 될듯


## <mark style="background: #DCFF8C;">CloudFront</mark>
- AWS의 콘텐츠 전달 네트워크(CDN) 서비스
- 영상, 이미지등 대용량 디지털 콘텐츠를 인터넷에서 효율적으로 사용자에게 전달하기 위한 네트워크
- 원본서버(Origin) 에서 데이터의 복사본(cache)을 전 세계에 존재하는 캐시 서버에 저장
	- CDN 은 사용자의 위치를 파악해 자동으로 가장 가까운 곳에 있는 캐시 서버로 연결
- 장점
	- 대용량 콘텐츠의 빠른 배포
	- 가용성 향상 - 전 세계에 엣지 로케이션을 가지고 있고, 원본 서버에 대한 부하가 분산돼 결과적으로 가용성이 향상
- S3, ALB, EC2, API Gateway, 온프레미스 서버 등에 대해 Origin 설정이 가능
	- EC2의 경우 자주 사용되는 이미지, CSS, HTML 캐싱
	- API 의 경우 동일한 API 요청을 캐싱
- 원본에서 장애 발생시 동작 설정 가능
- 확장자, 경로 패턴 단위로 제어 가능
- 특정 위치로부터의 접속을 헉가 또는 차단 설정 가능
- CF에서 캐시 수동 삭제 가능
- 요금 - 실제로 사용한 데이터 전송량, CF에 대한 요청 수에 따라 요금이 결정