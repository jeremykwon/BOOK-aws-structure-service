# 데이터베이스 서비스

## RDB, NoSQL
- RDB
	- 관계형 데이터베이스로 하나의 표를 테이블이라는 단위로 관리한다
	- 여러 테이블이 관계성을 가지고 관리된다.
	- SQL 언어를 사용해 데이터 CRUD를 조작
	- 스키마가 엄격하다.
	- 읽기 성능이 뛰어나며, 쓰기는 인덱스나 트랜잭션으로 인해 상대적으로 느릴 수 있음
	- 복잡한 쿼리, JOIN 연산이 가능하지만 트랜잭션이 많을 경우 성능 저하 가능
- NoSQL
	- key - value, 그래프 등의 형태로 데이터를 관리하는 DB
	- 스키마가 유연함
	- 관계를 정의하지 않고 중첩된 구조를 활용한다.
	- 쓰기 성능이 뛰어나며, 읽기는 데이터 모델에 따라 다름
	- 분산 저장을 통해 대량의 데이터와 높은 트래픽을 빠르게 처리 가능


## 데이터 불일치를 없애기 위한 <mark style="background: #DCFF8C;">ACID</mark> 특성
> 트랜잭션?
>  -> DB에서 수행하는 일련의 처리
- <mark style="background: #DCFF8C;">Atomicity</mark> (원자성)
	- 트랜잭션은 모두 실행되거나 실행되지 않아야 한다.
- <mark style="background: #DCFF8C;">Consistency</mark> (일관성)
	- 정해진 DB 규칙을 만족해야한다는 특성
	- 가령 고객 이름이 필수값인데 이름이 없다면 일관성을 위반하는 것
- <mark style="background: #DCFF8C;">Isolation</mark> (독립성)
	- 트랜잭션을 단독으로 실행할 때나 동시에 여러 개를 실행할 때 결과가 같아야 한다는 특성
- <mark style="background: #DCFF8C;">Durability</mark> (지속성)
	- 하드웨어 등의 장애가 있어도 완료된 트랜잭션의 결과는 손실되지 않아야 한다는 특성

## AWS RDS
- AWS RDS는 MySQL, SQL server, MariaDB, PostgreSQL, Oracle, Amazon, Aurora 등의 엔진을 지원
- AWS RDS 사용시 DB 엔진 설치면 OS 설정을 할 필요가 없이 DB를 즉시 사용할 수 있다 (AWS 가 설정)
- EC2 와 마찬가지로 인스턴스에 따라 성능이 달라진다.
- 스토리지 유형
	- 범용 SSD - 고성능, 용량에따라 R/W 성능 결정
	- 프로비저닝 IOPS SSD - 고성능이며 지정한 R/W 성능 확보
	- 마그네틱 HDD - 저렴한 비용
- 장애조치 (Fail Over)
	- 프라이머리 인스턴스 외에 예비 복제본을 다중 AZ에 배포해 가용성을 높일 수 있다.
	- 프라이머리 인스턴스나 AZ에 장애 발생시 예비복제본으로 전환해 DB를 계속 이용할 수 있다.
		- APP 에서 RDS 접속시 '엔드포인트' 라는 DNS 형식의 접속 정보를 사용하는데 프라이머리에 장애시 엔트포인트의 목적지가 자동으로 예비 복제본으로 전환된다.
- 읽기전용 레플리카
	- 프라이머리 인스턴스에서 복제된 인스턴스
	- 읽기 요청이 늘어나면 인스턴스의 수를 늘리는 스케일 아웃 방식으로 성능을 향상할 수 있다.
	- 읽기만 가능하므로 쓰기 성능은 인스턴스의 크기를 변경하는 스케일 업으로 성능을 향상해야한다.
- 자동 백업 기능이 있어 사용자가 지정한 일 수만큼의 스냅샷이 자동 유지된다. (보존일 0~35일 지정 가능)
	- 스냅샷은 S3에 저장
	- 일반적으로 RDS요금의 1/10 정도의 요금 발생
	
- <mark style="background: #DCFF8C;">Aurora</mark>
	- AWS 가 클라우드 용으로 구축한 DB
	- MySQL, PostgreSQL 호환성을 추가해 각 DB 과 동일하게 사용 가능
	- <mark style="background: #DCFF8C;">DB 클러스터</mark> 단위로 관리, 처리를 수행하는 하나 이상의 <mark style="background: #DCFF8C;">DB 인스턴스</mark>와 데이터를 관리하는 <mark style="background: #DCFF8C;">클러스터 볼륨</mark> 으로 구성
	- 클러스터 볼륨 (스토리지)
		- 3개의 AZ에 2개씩 총 **6개의 사본을 작성**해 높은 내결함성을 가짐
		- <mark style="background: #DCFF8C;">쿼럼모델</mark> 이라는 복제 관리 구조를 사용
			- 쓰기 처리는 6개중 4개, 읽기처리는 6개중 3개가 성공하면 클라이언트에 성공이라고 반환한다.
	- Aurora 복제
		- 일반 RDS는 가용성 향상을 위해 예비 복제와 읽기성능 향상을 위한 읽기 복제 준비 필요
		  Aurora 복제는 한 개로 가용성 향상과 읽기 성능 향상을 모두 달성 가능
			- Aurora 복제는 평상시에는 읽기 처리를 수행해 읽기 성능을 올리고, 장애발생시에는 프라이머리 인스턴스로 전환 된다.
		- 여러개의 Aurora 복제를 생성해 읽기 처리를 분산할 수 있다. (읽가용 엔드포인트의 URL을 지정해 각 복제에 뷴산 처리 가능하며 APP에서는 하나의 DB처럼 사용 가능)
	- 스토리지
		- 일반적인 RDS 엔진의 경우 디스크 성능 요건에 맞게 스토리지 유형과 확보할 용량을 사용자가 결정하는데 Aurora 에서는 스토리지 유형과 용량을 지정할 필요가 없다 (스토리지 관리를 AWS가 수행).
		- Aurora의 클러스터 볼륨은 데이터양에 따라 최대 128TB까지 자동으로 증가
	- 백업
		- 자체 자동 백업 기능 존재
		- 설정된 보존 기간만큼 지속해서 차분 데이터를 취득 (보존 기간 내 임의의 시점으로 복원 가능)
	- 인스턴스의 크기 지정이 필요하지 않은 Aurora serverless 도 존재

	- 한눈에 정리하는 Aurora
		![|483](https://i.imgur.com/Qqq27v7.png)


## DynamoDB
- Key - Value DB
- 단순한 데이터 구조이브로 복잡한 검색을 할 수 없지만 고속으로 데이터 추출 가능
- AWS에서 제공하는 완전 관리형 <mark style="background: #DCFF8C;">NoSQL 데이터베이스 서비스</mark>이다.  
- 키-값(Key-Value) 및 문서(Document) 저장 방식을 지원하며, 수평 확장(Scale-Out)과 <mark style="background: #DCFF8C;">초고속 성능</mark>이 강점이다.  
- 서버리스(Serverless) 아키텍처로 운영되며, 자동 확장 기능을 통해 높은 트래픽을 처리할 수 있다.
- 테이블 간 관계를 설정할 수 없으며, 복잡한 쿼리(SQL 기반의 WHERE, GROUP BY, JOIN 등)를 수행하기 어려움.
- EC2나 RDS와 같이 유저가 인스턴스(서버)를 소유하는 개념이 나닌 DynamoDB라는 하나의 서비스가 요청을 처리 (유저는 테이블생성, 관리만 수행)
- 이용요금
	- 요청을 처리할 양을 예약하고 그 양만큼의 요금이 부과
		- 예약량 초과시 오류를 반환, 오토스케일링 사용하면 살제 요청 수에 따라 지정된 범위 내에서 예약량을 자동으로 변경 가능
	- 무제한으로 처리하는 경우 이용한만큼 요금 발생
	- + 데이터 보관료 발생
	- 처리량은 커패서티 유닛으로 불리며 RCU(read capacity unit), WCU(write capacity unit)로 표기한다.
- 보수
	- <mark style="background: #DCFF8C;">AWS에서는 장애대비를 위해 DynamoDB 데이터를 이중화하여 저장</mark>한다.
		- 3개의 AZ에 실시간으로 데이터를 복제해 어느 하나의 AZ에 장애가 발생해도 문제없이 서비스를 이용할 수 있다.
	- 특정복구시점(PITR) 이라는 실시간 백업기능이 있음
		- PITR 활성화시 35일 내 임의의 시점으로 테이블 데이터를 되돌릴 수 있어 갑자기 데이터 손실이 되어도 대응 가능
- 이용예
	- 하루에 10조건 이상, 초당 2,000만건 이상의 요청을 고속으로 처리 가능
	- 매우 빠른 처리속도가 강점이므로 데이터 교환이 많고 사용자에게 빠른 응답이 필요한 응용 프로그램에 이용된다.
		- 모바일, 웹, 게임, 광고, IoT 등


## 그 밖의 유용한 서비스

- Redshift 
	- 데이터 분석을 위한 데이터 웨어하우스 (데이터를 쌓아두는 역할)
	- SQL 사용

- 마이그레이션에 도움이 되는 서비스
	- <mark style="background: #DCFF8C;">DMS</mark> (AWS Database Migration Service)
		- DB 바이그레이션을 위한 서비스
		- 단순히 데이터를 옮기는 것 뿐 아닌 데이터 형식을 맞춰 옮겨주거나 마이그레이션 도중에 발생한 원본 데이터의 변경 내용도 추적해 반영 가능, 마이스레이션 이후 데이터에 문제가 없는지 검증하는 기능도 제공
	- <mark style="background: #DCFF8C;">SCT</mark> (AWS Conversion Tool)
		- 스키마 - DB의 데이터 구조
		- 서로 다른 DB 엔진에 데이터를 마이그레이션할 때 데이터 자체를 옮기기 전에 먼저 스키마를 변환해줌
		- 평가 보고서를 통해 자동 변환 개요, 자동 변환이 불가능한 부분, 수동 변환 난이도, 권장사항 등의 내용도 제공
	- ![|522](https://i.imgur.com/lwcC6yL.png)

- ElastiCache
	- 인메모리 데이터 스토어
	- 보조기억장치에 데이터를 저장하는 것보다 고속으로 데이터를 읽고쓸수있게 해준다.
		- 시스템이 정지되면 데이터가 모두 삭제됨
	- Redis, Memcached 와 호환
		- ElastiCache for Memcached
		- ElastickCache for Redis


- Memory for Redis
	- 메모리 뿐 아닌 보조기억장치에도 데이터를 저장해 메모리의 데이터가 사라지더라도 복구할 수 있는 기능을 갖추고있다.

- DocumentDB
	- 문서 지향 DB 서비스
	- MongoDB와 호환성이 있음
	- 문서 데이터를 저장하는데 뛰어난 DB, 데이터를 JSON 형식으로 보관하고 해당 내용 검색 가능
	- DynamoDB는 key 로만 레코드를 검색할 수 있는데 모든 요소를 이용해 레코드 검사 가능
	- ![|311](https://i.imgur.com/ilqnTyb.png)
		- 문서지향 DB는 모든 요소 검색 가능
			- ex) 소속이 OO이고 입사년도가 XX 인 데이터는?
			- 직원 번호가 OO인 데이터는?
		- 키 - 값형 DB는 기본 키로만 검색 가능
			- 직원 번호(프라이머리키)가 OO 인 데이터는?

