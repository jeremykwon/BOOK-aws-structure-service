# 컴퓨팅서비스

## <mark style="background: #DCFF8C;">EC2</mark> (Amazon Elastic Compute Cloud)
----
- 몇 분 만에 가상 서버를 생성할 수 있는 서비스
- AWS 에서 OS, 와 하드웨어 등을 제공해 가상의 서버용 컴퓨터를 사용할 수 있다.
	- Amazon Machine Image(AMI) 는 OS와 S/W 가 설정된 템플릿, 이를 선택해 EC2 를 띄움
- 인스턴스 단위로 가상 서버를 관리
- VPC, 스토리지 용량 (EBS), 보안그룹 세팅 필요

```
// 인스턴스 유형의 이름
m6g.medium

m: 인스턴스 패밀리 (아래 표로 설명)
6: 세대 (클수록 성능이 좋음)
g: 추가 기능
midium: 크기가 클수록 고성능
```

| 패밀리 | 특징                    |
| :-- | :-------------------- |
| T   | 버스트 가능한 범용 유형         |
| M   | 균형잡힌 범용 유형            |
| C   | 컴퓨팅 최적화 (vCPU 수가 많음)  |
| R   | 메모리 최적화 (메모리 탑재량이 많음) |
| P   | 고속 컴퓨팅                |
| I   | 스토리지 최적화              |

### EC2 요금제
| 구매 유형   |                                  특징                                   | 이용 용도                          |
| :------ | :-------------------------------------------------------------------: | ------------------------------ |
| 온디맨드    |                      일반적인 구매 방법.<br>이용에 따른 요금 부과                      | 이용 상황에 변화가 있고 사용 예정 일을 모르는 경우  |
| 예약 인스턴스 |            1년 or 3년간의 이용 요금을 미리 지불, <br>온디맨드에 비해 최대 72% 저렴            | 프로덕션 가동 등 1년 이상 사용할 예정이 있는 경우  |
| 스팟 인스턴스 | 이용하지 않는 자원을 활용해 인스턴스를 생성,<br>예기치 않게 인스턴스 정지 가능,<br>온디맨드에 비해 최대 90% 저렴 | 개발 환경과 같이 인스턴스를 중단해도 영향이 적은 경우 |
- 네트워크 외부로의 데이터 통신시 추가 요금 부과
	- 데이터가 EC2에서 나가는 경우만 요금 부과 (ex. 유저가 파일을 다운로드)
	- S3 나 CloudFront 를 사용하면 비용 절감 가능 (비용이 더 저렴하거나 캐싱을 이용하기 때문)

### EC2 를 외부에 공개하는 방법
다음 세가지 조건을 충족해야한다
1. EC2를 퍼블릭 서브넷에 배치
	1. 서브넷이란 VPC 내의 특정 범위의 IP 를 가진 네트워크 구역이다.
	2. 퍼블릭 서브넷은 인터넷 게이트웨이가 있고 인터넷 통신이 가능한 서브넷이다.
2. 퍼블릭 IP 주소를 EC2에 부여
3. 보안그룹에서 외부로부터의 접근을 허가
	1. 보안그룹은 특정인스턴스가 특정 주소, 특정 대역, 전체 인터넷과 통신할 수 있도록 규칙을 만들어 규칙에 따라 통신을 제어 (방화벽 기능)
	2. 인바운드 규칙 (외부 -> EC2 로의 통신) -> 관리자만 접속 허용하면 됨
	3. 아웃바운드 규칙 (EC2 -> 외부 로의 통신) -> 기본적으로 모든 트래픽 허용
	4. 인바운드 규칙에서 IP를 입력하는 것보다 보안그룹 ID를 입력하는 것이 안전하다 (변경되지 않으므로)

### <mark style="background: #DCFF8C;">Auto Scailing</mark>
(EC2, ECS, RDS 등에서 사용가능)
- 부하에 따라 서버를 자동으로 추가 삭제하는 기능으로
- 스케일-아웃(서버추가), 스케일-인(서버제거)
- 추가 삭제 규칙을 지정할 수 있다.
	- ex) CPU 사용량 50%가 넘으면 스케일-아웃
	- 대상 추적 조정 정책: 목표 사용률을 유지 하도록
	- 스케줄 스케일: 특정 기간은 적게, 특정 날요일은 높게 등
- 장애 대비용으로도 사용 가능, 지정된 인스턴스 수를 유지하는 기능이 있어 예기치 못한 장애가 발생해 인스턴스가 멈추면 자동으로 인스턴스가 새로 만들어짐



## <mark style="background: #DCFF8C;">서버 없이 프로그램 실행</mark> (Lambda)
----
- <mark style="background: #DCFF8C;">서버리스 컴퓨팅</mark>
	- **AWS 에서 서비스가 실핼될 인프라를 관리하므로 사용자가 관리할 서버가 없다는 것**
	- OS 같은 인프라를 관리할 필요가 없으므로 사용자는 프로그램 코드를 준비하고 Lambda 에 업로드만 하면 된다.
- <mark style="background: #DCFF8C;">Lambda 의 장점</mark>
	- 보안: 미들웨어, OS 등의 관리를 AWS 가 한다.
	- 비용: EC2는 기동 시간만큼 요금부과, but Lambda는 코드가 실행될때만 요금이 부과
	- 가용성: 복수의 AZ에서 실행된다. 사용자가 설정하지 않아도 가용성 장애 대응성이 유지된다.
	- 확장성: 동시에 다수의 처리를 해야 하는 경우 자동으로 AWS가 관리하는 처리용 인스턴스가 시작되면서 확장된다.
- 함수 단위로 프로그램 코드를 관리하고 처리한다
	1. 함수 생성
		1. 함수명
		2. 런타임 환경설정 (언어, 버전)
	2. 코드 입력 - 테스트 가능
	3. deploy
- Lambda는 AWS 다른 서비스와 연계해 사용이 가능하다
	- S3: 저장시 자동 처리
	- API Gateway(클라 - 서버 API 요청 처리): EC2 없이 서버리스 API 개발 가능
		- ex) 클라이언트 → API Gateway → Lambda → DynamoDB
	- EventBridge: 주기적으로 정해진 시간에 Lambda 함수 실행
- Lambda 와 AWS 다른 서비스를 연꼐해 사용하려면 다른 서비스에 대한 권한을 따로 부여해야 한다.
- Lambda 요금
	- 프리티어 기준: 매월 100만건 무료, 매월  40만 GB-초 무료 (메모리 1GB의 함수가 1초간 실행된 경우의 요금)
	- ex) 메모리 용량을 1GB 로 설정한 Lambda 함수를 150만번 호출하고 회당 평균 실행시간이 1초인 경우
		- 요청 100만 건당 x 의 비용
		- 실행시간 1GB, 1초당 t 의 비용
		- 1.5x + 1,500,000t  = B
		- B - 프리티어 비용이 실제 부과되는 비용
		- 결국 실행 횟수와 실생되는 시간 및 용량에 따라 금액이 다르다



## <mark style="background: #DCFF8C;">컨테이너</mark>
----
**컨테이너**:
- OS를 공유하며 애플리케이션을 격리
- 컨테이너 내에 포함된 것이 적으므로 **가볍고 빠름** (마이크로서비스, 클라우드 네이티브 환경에 적합) 
- 리소스를 효율적으로 사용
- 쉐어하우스에 비교
	- 가구, 공용 공간을 공유해 사용한다
- 컨테이너는 완성된 이미지이므로 이미지를 다른서버에서 바로 사용가능
	- 대신 컨테이너 종료시 안에 저장된 내용이 사라진다.
**가상화(VM)**:
- 각 VM마다 OS를 포함하여 격리
- 무겁지만 보안성이 높음 (레거시 애플리케이션, 멀티 OS 환경에 적합)
- 아파트에 비교
	- 각각의 가구가 있다.
- 하이퍼바이저로 가상화 기술을 구현
	- 하이퍼바이저(Hypervisor)는 하드웨어에서 여러 개의 가상 머신(VM)을 실행할 수 있도록 해주는 소프트웨어


### 컨테이너 오케스트레이션
- 컨테이너 비정상 종료시 재실행, 부하에 따른 컨테이너 증가 감소 등의 관리를 자동화해 운영 부하를 줄여준다.
- <mark style="background: #DCFF8C;">ECS</mark> (Amazon Elastic Container Service)
	- AWS 의 관리형 컨테이너 오케스트레이션 서비스
	- 컨테이너 배포, 상태 모니터링, 스케일링 관리, 작업 정의를 기반으로 설정된 컨테이너의 상태와 수를 유지한다.
	- 노드란 컨테이너를 실행하는 서버, ECS의 경우 EC2 또는 Fagate 를 선택할 수 있다.
- ECR (Amazon Elastic Container Registry)
	- 컨테이너 이미지 레지스트리 서비스
	- 사용자 정의된 컨테이너 이미지를 AWS에서 관리할 수 있고 ECS에 쉽게 배포 가능


### <mark style="background: #DCFF8C;">Fagate</mark>
- AWS 에서 관리하는 서버에서 컨테이너를 실행
- 컨테이너 이미지만 관리하면돼 편리하다.


### 서버지식 없이 사용 가능한 대표적 서비스
----
- AWS Lightsail
	- 일반적으로 자주 사용되는 구성의 가상 서버를 쉽소 빠르게 구축하기 위한 서비스
	-  로드밸런싱도 해줌
- AWS Elastic Beanstalk
	- 플랫폼 지정 후 응용 프로그램 코드 업로드시 EC2, RDS, S3 와 같은 AWS 자원이 자동으로 구축되고 응용 프로그램이 배포됨 (이것만 보면 너무 좋은데)
	- 세부적 인프라 제어 어려움
	- 배포속도 느림, 롤백 불편
	- 장애발생시 문제해결이 어려움
	- 비용 최적화가 어려움
- AWS App Runner
	- 컨테이너화된 응용 프로그램을 손쉽게 배포하는 서비스
	- 컨테이너 이미지 지정, 서비스포트, 오토스케일링과 같은 설정으로 파게이트에 배포 가능